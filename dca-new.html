<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DCA vs Lump Sum - Bitcoin Calculator</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .results-section {
            margin-top: 2rem;
            padding: 1.5rem;
            background: #1a1a1a;
            border-radius: 12px;
            border: 1px solid #333;
        }
        
        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin: 1rem 0;
        }
        
        .result-card {
            background: #2a2a2a;
            padding: 1.5rem;
            border-radius: 8px;
            border: 1px solid #444;
            text-align: center;
        }
        
        .result-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #f7931a;
            margin: 0.5rem 0;
        }
        
        .summary-section {
            margin-top: 1.5rem;
            padding: 1rem;
            background: #2a2a2a;
            border-radius: 8px;
        }
        
        .summary-item {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
            border-bottom: 1px solid #444;
        }
        
        .summary-item:last-child {
            border-bottom: none;
        }
        
        .hidden {
            display: none !important;
        }
        
        .visible {
            display: block !important;
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="header-content">
                <div class="logo">
                    <i class="fab fa-bitcoin"></i>
                    <h1>Bitcoin Calculator</h1>
                </div>
                <nav class="nav-links">
                    <a href="index.html">Spending Calculator</a>
                    <a href="dca-new.html" class="active">DCA vs Lump Sum</a>
                </nav>
            </div>
        </header>

        <main class="main">
            <div class="page-header">
                <h1><i class="fas fa-chart-line"></i> DCA vs Lump Sum Calculator</h1>
                <p>Compare Dollar Cost Averaging vs Lump Sum Bitcoin investment strategies</p>
            </div>

            <div class="calculator-container">
                <div class="input-section">
                    <div class="investment-amount-section">
                        <h3><i class="fas fa-dollar-sign"></i> Investment Amount</h3>
                        <div class="input-group">
                            <label for="investmentAmount">Total Investment ($)</label>
                            <input type="number" id="investmentAmount" value="10000" min="1" step="1">
                        </div>
                    </div>

                    <div class="strategy-selection">
                        <h3><i class="fas fa-toggle-on"></i> Investment Strategy</h3>
                        <div class="strategy-toggle">
                            <button id="dcaBtn" class="strategy-btn active">
                                <i class="fas fa-calendar-alt"></i>
                                Dollar Cost Averaging
                            </button>
                            <button id="lumpBtn" class="strategy-btn">
                                <i class="fas fa-coins"></i>
                                Lump Sum
                            </button>
                        </div>
                    </div>

                    <div id="dcaOptions" class="strategy-options">
                        <h4>DCA Configuration</h4>
                        <div class="input-row">
                            <div class="input-group">
                                <label for="dcaStartDate">Start Date</label>
                                <input type="date" id="dcaStartDate">
                            </div>
                            <div class="input-group">
                                <label for="dcaAmount">DCA Amount ($)</label>
                                <input type="number" id="dcaAmount" value="500" min="1" step="1">
                            </div>
                        </div>
                        <div class="input-group">
                            <label for="dcaFrequency">Frequency</label>
                            <select id="dcaFrequency">
                                <option value="weekly">Weekly</option>
                                <option value="monthly" selected>Monthly</option>
                            </select>
                        </div>
                    </div>

                    <div id="lumpOptions" class="strategy-options hidden">
                        <h4>Lump Sum Configuration</h4>
                        <div class="input-group">
                            <label for="lumpDate">Investment Date</label>
                            <input type="date" id="lumpDate">
                        </div>
                    </div>

                    <button id="calculateBtn" class="calculate-btn">
                        <i class="fas fa-calculator"></i>
                        Calculate Returns
                    </button>
                </div>

                <div id="resultsSection" class="results-section hidden">
                    <h3><i class="fas fa-chart-bar"></i> Investment Results</h3>
                    
                    <div class="results-grid">
                        <div class="result-card">
                            <h4><i class="fab fa-bitcoin"></i> Bitcoin Acquired</h4>
                            <div id="btcAmount" class="result-value">0.00000000 BTC</div>
                        </div>
                        <div class="result-card">
                            <h4><i class="fas fa-dollar-sign"></i> Current Value</h4>
                            <div id="currentValue" class="result-value">$0.00</div>
                        </div>
                        <div class="result-card">
                            <h4><i class="fas fa-chart-line"></i> Total Gains</h4>
                            <div id="totalGains" class="result-value">$0.00</div>
                        </div>
                        <div class="result-card">
                            <h4><i class="fas fa-percentage"></i> Return %</h4>
                            <div id="returnPercentage" class="result-value">0.00%</div>
                        </div>
                    </div>

                    <div class="summary-section">
                        <h4>Investment Summary</h4>
                        <div id="summaryDetails">
                            <!-- Summary will be populated by JavaScript -->
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        let currentStrategy = 'dca';

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            initializePage();
            setupEventListeners();
        });

        function initializePage() {
            // Set default dates
            const today = new Date();
            const oneYearAgo = new Date(today.getFullYear() - 1, today.getMonth(), today.getDate());
            
            document.getElementById('dcaStartDate').value = oneYearAgo.toISOString().split('T')[0];
            document.getElementById('lumpDate').value = oneYearAgo.toISOString().split('T')[0];
        }

        function setupEventListeners() {
            document.getElementById('dcaBtn').addEventListener('click', () => switchStrategy('dca'));
            document.getElementById('lumpBtn').addEventListener('click', () => switchStrategy('lump'));
            document.getElementById('calculateBtn').addEventListener('click', calculateReturns);
        }

        function switchStrategy(strategy) {
            currentStrategy = strategy;
            
            // Update button states
            document.getElementById('dcaBtn').classList.toggle('active', strategy === 'dca');
            document.getElementById('lumpBtn').classList.toggle('active', strategy === 'lump');
            
            // Show/hide options
            document.getElementById('dcaOptions').classList.toggle('hidden', strategy !== 'dca');
            document.getElementById('lumpOptions').classList.toggle('hidden', strategy !== 'lump');
        }

        async function calculateReturns() {
            const investmentAmount = parseFloat(document.getElementById('investmentAmount').value);
            
            if (!investmentAmount || investmentAmount <= 0) {
                alert('Please enter a valid investment amount');
                return;
            }

            try {
                let results;
                if (currentStrategy === 'dca') {
                    results = await calculateDCAReturns(investmentAmount);
                } else {
                    results = await calculateLumpSumReturns(investmentAmount);
                }
                
                displayResults(results);
            } catch (error) {
                console.error('Calculation error:', error);
                alert('Unable to calculate returns. Please try again.');
            }
        }

        async function calculateDCAReturns(investmentAmount) {
            const dcaAmount = parseFloat(document.getElementById('dcaAmount').value);
            const startDate = new Date(document.getElementById('dcaStartDate').value);
            const frequency = document.getElementById('dcaFrequency').value;
            
            if (!dcaAmount || dcaAmount <= 0) {
                throw new Error('Please enter a valid DCA amount');
            }

            // Calculate number of purchases
            const today = new Date();
            const daysDiff = Math.floor((today - startDate) / (1000 * 60 * 60 * 24));
            const intervalDays = frequency === 'weekly' ? 7 : 30;
            const numberOfPurchases = Math.floor(daysDiff / intervalDays);
            
            if (numberOfPurchases <= 0) {
                throw new Error('Start date must be in the past');
            }

            // Generate purchases
            const purchases = [];
            let totalInvested = 0;
            let totalBTC = 0;
            
            for (let i = 0; i < numberOfPurchases && totalInvested < investmentAmount; i++) {
                const purchaseDate = new Date(startDate);
                purchaseDate.setDate(purchaseDate.getDate() + (i * intervalDays));
                
                const amountToInvest = Math.min(dcaAmount, investmentAmount - totalInvested);
                const btcPrice = simulateBitcoinPrice(purchaseDate);
                const btcPurchased = amountToInvest / btcPrice;
                
                purchases.push({
                    date: purchaseDate,
                    amount: amountToInvest,
                    btcPrice: btcPrice,
                    btcPurchased: btcPurchased
                });
                
                totalInvested += amountToInvest;
                totalBTC += btcPurchased;
            }

            // Get current Bitcoin price
            const currentBTCPrice = await getCurrentBitcoinPrice();
            const currentValue = totalBTC * currentBTCPrice;
            const totalGains = currentValue - totalInvested;
            const returnPercentage = (totalGains / totalInvested) * 100;

            return {
                strategy: 'DCA',
                btcAmount: totalBTC,
                currentValue: currentValue,
                totalGains: totalGains,
                returnPercentage: returnPercentage,
                totalInvested: totalInvested,
                purchases: purchases,
                currentBTCPrice: currentBTCPrice
            };
        }

        async function calculateLumpSumReturns(investmentAmount) {
            const investmentDate = new Date(document.getElementById('lumpDate').value);
            
            const today = new Date();
            if (investmentDate >= today) {
                throw new Error('Investment date must be in the past');
            }

            const btcPriceAtPurchase = simulateBitcoinPrice(investmentDate);
            const btcPurchased = investmentAmount / btcPriceAtPurchase;
            
            const currentBTCPrice = await getCurrentBitcoinPrice();
            const currentValue = btcPurchased * currentBTCPrice;
            const totalGains = currentValue - investmentAmount;
            const returnPercentage = (totalGains / investmentAmount) * 100;

            return {
                strategy: 'Lump Sum',
                btcAmount: btcPurchased,
                currentValue: currentValue,
                totalGains: totalGains,
                returnPercentage: returnPercentage,
                totalInvested: investmentAmount,
                purchases: [{
                    date: investmentDate,
                    amount: investmentAmount,
                    btcPrice: btcPriceAtPurchase,
                    btcPurchased: btcPurchased
                }],
                currentBTCPrice: currentBTCPrice
            };
        }

        function simulateBitcoinPrice(date) {
            const today = new Date();
            const daysDiff = Math.floor((today - date) / (1000 * 60 * 60 * 24));
            
            // Base current price
            const currentPrice = 60000;
            const volatility = 0.02; // 2% daily volatility
            const trend = -0.0001; // Slight upward trend over time
            
            let price = currentPrice;
            for (let i = 0; i < daysDiff; i++) {
                const randomChange = (Math.random() - 0.5) * volatility * 2;
                price = price * (1 + randomChange - trend);
            }
            
            return Math.max(price, 10000); // Minimum $10k
        }

        async function getCurrentBitcoinPrice() {
            try {
                const response = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=bitcoin&vs_currencies=usd');
                const data = await response.json();
                return data.bitcoin.usd;
            } catch (error) {
                return 60000; // Fallback price
            }
        }

        function displayResults(results) {
            // Update result values
            document.getElementById('btcAmount').textContent = results.btcAmount.toFixed(8) + ' BTC';
            document.getElementById('currentValue').textContent = '$' + results.currentValue.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2});
            document.getElementById('totalGains').textContent = '$' + results.totalGains.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2});
            document.getElementById('returnPercentage').textContent = results.returnPercentage.toFixed(2) + '%';
            
            // Update colors based on gains/losses
            const gainsElement = document.getElementById('totalGains');
            const percentageElement = document.getElementById('returnPercentage');
            
            if (results.totalGains >= 0) {
                gainsElement.style.color = '#00ff88';
                percentageElement.style.color = '#00ff88';
            } else {
                gainsElement.style.color = '#ff4444';
                percentageElement.style.color = '#ff4444';
            }

            // Update summary
            updateSummary(results);
            
            // Show results section
            document.getElementById('resultsSection').classList.remove('hidden');
            document.getElementById('resultsSection').scrollIntoView({ behavior: 'smooth' });
        }

        function updateSummary(results) {
            const summaryContainer = document.getElementById('summaryDetails');
            let summaryHTML = '';
            
            if (results.strategy === 'DCA') {
                const avgPrice = results.totalInvested / results.btcAmount;
                summaryHTML = `
                    <div class="summary-item">
                        <span>Strategy:</span>
                        <span>Dollar Cost Averaging</span>
                    </div>
                    <div class="summary-item">
                        <span>Number of Purchases:</span>
                        <span>${results.purchases.length}</span>
                    </div>
                    <div class="summary-item">
                        <span>Average Purchase Price:</span>
                        <span>$${avgPrice.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}</span>
                    </div>
                    <div class="summary-item">
                        <span>Total Invested:</span>
                        <span>$${results.totalInvested.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}</span>
                    </div>
                `;
            } else {
                summaryHTML = `
                    <div class="summary-item">
                        <span>Strategy:</span>
                        <span>Lump Sum Investment</span>
                    </div>
                    <div class="summary-item">
                        <span>Investment Date:</span>
                        <span>${results.purchases[0].date.toLocaleDateString()}</span>
                    </div>
                    <div class="summary-item">
                        <span>Purchase Price:</span>
                        <span>$${results.purchases[0].btcPrice.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}</span>
                    </div>
                    <div class="summary-item">
                        <span>Total Invested:</span>
                        <span>$${results.totalInvested.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}</span>
                    </div>
                `;
            }
            
            summaryContainer.innerHTML = summaryHTML;
        }
    </script>
</body>
</html>
